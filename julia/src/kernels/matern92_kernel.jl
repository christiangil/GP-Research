

"""
matern92_kernel function created by kernel_coder(). Requires 1 hyperparameters. Likely created using matern92_kernel_base() as an input. 
Use with include("src/kernels/matern92_kernel.jl").
hyperparameters == ["kernel_length"]
"""
function matern92_kernel(hyperparameters::AbstractArray{T1,1}, dif::Real; dorder::AbstractArray{T2,1}=zeros(length(hyperparameters) + 2)) where {T1<:Real, T2<:Real}

    @assert length(hyperparameters)==1 "hyperparameters is the wrong length"
    @assert length(dorder)==(length(hyperparameters) + 2) "dorder is the wrong length"
    dorder = convert(Array{Int64,1}, dorder)
    even_time_derivative = 2 * iseven(dorder[2]) - 1
    @assert maximum(dorder) < 3 "No more than two time derivatives for either t1 or t2 can be calculated"

    dorder = append!([sum(dorder[1:2])], dorder[3:end])

    kernel_length = hyperparameters[1]

    dif_positive = Bool((1 + sign(dif)) / 2)  # store original sign of dif (for correcting odd kernel derivatives)
    dif = abs(dif)  # this is corected for later

    if dorder==[4, 1]
        func = (-2592/35)*exp(-3*dif/kernel_length)/kernel_length^5 + (1944/35)*exp(-3*dif/kernel_length)*dif/kernel_length^6 + 324*exp(-3*dif/kernel_length)*(3*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length + 3*dif*(3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length + 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length^4 + 81*exp(-3*dif/kernel_length)*(-3*dif*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length^2 + 3*dif*(-3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length^2 + 3*dif*((-3/35)*dif^2/kernel_length^3 - 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length^2)/kernel_length)/kernel_length)/kernel_length^4 - 324*exp(-3*dif/kernel_length)*(1 + 3*dif*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length^5 + 12*exp(-3*dif/kernel_length)*((162/35)*dif/kernel_length^4 + 9*((18/35)*dif/kernel_length^3 + 6*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length^2 - 108*exp(-3*dif/kernel_length)*(6*(3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length + 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length + 3*dif*((18/35)*dif/kernel_length^3 + 6*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length^3 - 12*exp(-3*dif/kernel_length)*((-648/35)*dif/kernel_length^5 + 9*((-54/35)*dif/kernel_length^4 - 6*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length^2 + 6*((-9/35)*dif/kernel_length^3 - 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length^2)/kernel_length)/kernel_length - 9*((18/35)*dif/kernel_length^3 + 6*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length^2)/kernel_length - 108*exp(-3*dif/kernel_length)*(-3*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length^2 + 3*(-3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length^2 + 3*dif*((-3/35)*dif^2/kernel_length^3 - 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length^2)/kernel_length)/kernel_length - 3*dif*(3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length + 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length^2 + 3*dif*(-3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length^2 + 3*((-3/35)*dif^2/kernel_length^3 - 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length^2)/kernel_length - 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length^2 + 3*dif*((-9/35)*dif/kernel_length^3 - 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length^2)/kernel_length)/kernel_length)/kernel_length^3 + 54*exp(-3*dif/kernel_length)*(-6*(3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length + 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length^2 + 6*(-3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length^2 + 3*((-3/35)*dif^2/kernel_length^3 - 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length^2)/kernel_length - 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length^2 + 3*dif*((-9/35)*dif/kernel_length^3 - 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length^2)/kernel_length)/kernel_length + 3*dif*((-54/35)*dif/kernel_length^4 - 6*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length^2 + 6*((-9/35)*dif/kernel_length^3 - 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length^2)/kernel_length)/kernel_length - 3*dif*((18/35)*dif/kernel_length^3 + 6*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length^2)/kernel_length^2 - 324*exp(-3*dif/kernel_length)*dif*(3*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length + 3*dif*(3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length + 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length^5 + 243*exp(-3*dif/kernel_length)*dif*(1 + 3*dif*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length^6 - 36*exp(-3*dif/kernel_length)*dif*((162/35)*dif/kernel_length^4 + 9*((18/35)*dif/kernel_length^3 + 6*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length^3 + 162*exp(-3*dif/kernel_length)*dif*(6*(3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length + 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length + 3*dif*((18/35)*dif/kernel_length^3 + 6*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length^4
    end

    if dorder==[3, 1]
        func = exp(-3*dif/kernel_length)*((-648/35)*dif/kernel_length^5 + 9*((-54/35)*dif/kernel_length^4 - 6*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length^2 + 6*((-9/35)*dif/kernel_length^3 - 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length^2)/kernel_length)/kernel_length - 9*((18/35)*dif/kernel_length^3 + 6*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length^2) - 54*exp(-3*dif/kernel_length)*(3*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length + 3*dif*(3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length + 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length^3 - 27*exp(-3*dif/kernel_length)*(-3*dif*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length^2 + 3*dif*(-3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length^2 + 3*dif*((-3/35)*dif^2/kernel_length^3 - 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length^2)/kernel_length)/kernel_length)/kernel_length^3 + 81*exp(-3*dif/kernel_length)*(1 + 3*dif*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length^4 + 9*exp(-3*dif/kernel_length)*(6*(3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length + 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length + 3*dif*((18/35)*dif/kernel_length^3 + 6*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length^2 + 27*exp(-3*dif/kernel_length)*(-3*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length^2 + 3*(-3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length^2 + 3*dif*((-3/35)*dif^2/kernel_length^3 - 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length^2)/kernel_length)/kernel_length - 3*dif*(3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length + 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length^2 + 3*dif*(-3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length^2 + 3*((-3/35)*dif^2/kernel_length^3 - 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length^2)/kernel_length - 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length^2 + 3*dif*((-9/35)*dif/kernel_length^3 - 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length^2)/kernel_length)/kernel_length)/kernel_length^2 - 9*exp(-3*dif/kernel_length)*(-6*(3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length + 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length^2 + 6*(-3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length^2 + 3*((-3/35)*dif^2/kernel_length^3 - 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length^2)/kernel_length - 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length^2 + 3*dif*((-9/35)*dif/kernel_length^3 - 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length^2)/kernel_length)/kernel_length + 3*dif*((-54/35)*dif/kernel_length^4 - 6*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length^2 + 6*((-9/35)*dif/kernel_length^3 - 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length^2)/kernel_length)/kernel_length - 3*dif*((18/35)*dif/kernel_length^3 + 6*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length^2)/kernel_length + 81*exp(-3*dif/kernel_length)*dif*(3*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length + 3*dif*(3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length + 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length^4 - 81*exp(-3*dif/kernel_length)*dif*(1 + 3*dif*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length^5 + 3*exp(-3*dif/kernel_length)*dif*((162/35)*dif/kernel_length^4 + 9*((18/35)*dif/kernel_length^3 + 6*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length^2 - 27*exp(-3*dif/kernel_length)*dif*(6*(3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length + 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length + 3*dif*((18/35)*dif/kernel_length^3 + 6*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length^3
    end

    if dorder==[2, 1]
        func = exp(-3*dif/kernel_length)*(-6*(3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length + 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length^2 + 6*(-3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length^2 + 3*((-3/35)*dif^2/kernel_length^3 - 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length^2)/kernel_length - 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length^2 + 3*dif*((-9/35)*dif/kernel_length^3 - 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length^2)/kernel_length)/kernel_length + 3*dif*((-54/35)*dif/kernel_length^4 - 6*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length^2 + 6*((-9/35)*dif/kernel_length^3 - 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length^2)/kernel_length)/kernel_length - 3*dif*((18/35)*dif/kernel_length^3 + 6*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length^2) + 6*exp(-3*dif/kernel_length)*(3*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length + 3*dif*(3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length + 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length^2 + 9*exp(-3*dif/kernel_length)*(-3*dif*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length^2 + 3*dif*(-3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length^2 + 3*dif*((-3/35)*dif^2/kernel_length^3 - 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length^2)/kernel_length)/kernel_length)/kernel_length^2 - 18*exp(-3*dif/kernel_length)*(1 + 3*dif*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length^3 - 6*exp(-3*dif/kernel_length)*(-3*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length^2 + 3*(-3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length^2 + 3*dif*((-3/35)*dif^2/kernel_length^3 - 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length^2)/kernel_length)/kernel_length - 3*dif*(3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length + 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length^2 + 3*dif*(-3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length^2 + 3*((-3/35)*dif^2/kernel_length^3 - 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length^2)/kernel_length - 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length^2 + 3*dif*((-9/35)*dif/kernel_length^3 - 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length^2)/kernel_length)/kernel_length)/kernel_length - 18*exp(-3*dif/kernel_length)*dif*(3*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length + 3*dif*(3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length + 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length^3 + 27*exp(-3*dif/kernel_length)*dif*(1 + 3*dif*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length^4 + 3*exp(-3*dif/kernel_length)*dif*(6*(3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length + 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length + 3*dif*((18/35)*dif/kernel_length^3 + 6*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length^2
    end

    if dorder==[1, 1]
        func = exp(-3*dif/kernel_length)*(-3*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length^2 + 3*(-3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length^2 + 3*dif*((-3/35)*dif^2/kernel_length^3 - 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length^2)/kernel_length)/kernel_length - 3*dif*(3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length + 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length^2 + 3*dif*(-3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length^2 + 3*((-3/35)*dif^2/kernel_length^3 - 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length^2)/kernel_length - 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length^2 + 3*dif*((-9/35)*dif/kernel_length^3 - 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length^2)/kernel_length)/kernel_length) - 3*exp(-3*dif/kernel_length)*(-3*dif*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length^2 + 3*dif*(-3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length^2 + 3*dif*((-3/35)*dif^2/kernel_length^3 - 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length^2)/kernel_length)/kernel_length)/kernel_length + 3*exp(-3*dif/kernel_length)*(1 + 3*dif*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length^2 + 3*exp(-3*dif/kernel_length)*dif*(3*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length + 3*dif*(3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length + 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length^2 - 9*exp(-3*dif/kernel_length)*dif*(1 + 3*dif*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length^3
    end

    if dorder==[0, 1]
        func = exp(-3*dif/kernel_length)*(-3*dif*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length^2 + 3*dif*(-3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length^2 + 3*dif*((-3/35)*dif^2/kernel_length^3 - 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length^2)/kernel_length)/kernel_length) + 3*exp(-3*dif/kernel_length)*dif*(1 + 3*dif*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length^2
    end

    if dorder==[4, 0]
        func = (648/35)*exp(-3*dif/kernel_length)/kernel_length^4 - 108*exp(-3*dif/kernel_length)*(3*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length + 3*dif*(3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length + 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length^3 + 81*exp(-3*dif/kernel_length)*(1 + 3*dif*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length^4 - 12*exp(-3*dif/kernel_length)*((162/35)*dif/kernel_length^4 + 9*((18/35)*dif/kernel_length^3 + 6*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length + 54*exp(-3*dif/kernel_length)*(6*(3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length + 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length + 3*dif*((18/35)*dif/kernel_length^3 + 6*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length^2
    end

    if dorder==[3, 0]
        func = exp(-3*dif/kernel_length)*((162/35)*dif/kernel_length^4 + 9*((18/35)*dif/kernel_length^3 + 6*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length) + 27*exp(-3*dif/kernel_length)*(3*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length + 3*dif*(3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length + 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length^2 - 27*exp(-3*dif/kernel_length)*(1 + 3*dif*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length^3 - 9*exp(-3*dif/kernel_length)*(6*(3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length + 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length + 3*dif*((18/35)*dif/kernel_length^3 + 6*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length
    end

    if dorder==[2, 0]
        func = exp(-3*dif/kernel_length)*(6*(3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length + 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length + 3*dif*((18/35)*dif/kernel_length^3 + 6*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length) - 6*exp(-3*dif/kernel_length)*(3*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length + 3*dif*(3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length + 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length + 9*exp(-3*dif/kernel_length)*(1 + 3*dif*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length^2
    end

    if dorder==[1, 0]
        func = exp(-3*dif/kernel_length)*(3*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length + 3*dif*(3*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length + 3*dif*((3/35)*dif/kernel_length^2 + 3*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length) - 3*exp(-3*dif/kernel_length)*(1 + 3*dif*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)/kernel_length
    end

    if dorder==[0, 0]
        func = exp(-3*dif/kernel_length)*(1 + 3*dif*(1 + 3*dif*(0.428571428571429 + 3*dif*(0.0952380952380952 + (1/35)*dif/kernel_length)/kernel_length)/kernel_length)/kernel_length)
    end

    return (2 * (dif_positive | iseven(dorder[1])) - 1) * even_time_derivative * float(func)  # correcting for use of abs_dif and amount of t2 derivatives

end


return matern92_kernel, 1  # the function handle and the number of kernel hyperparameters

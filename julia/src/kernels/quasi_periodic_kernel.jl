

"""
quasi_periodic_kernel function created by kernel_coder(). Requires 3 hyperparameters. Likely created using quasi_periodic_kernel_base() as an input. 
Use with include("src/kernels/quasi_periodic_kernel.jl").
hyperparameters == ["P_kernel_length", "P_kernel_period", "RBF_kernel_length"]
"""
function quasi_periodic_kernel(hyperparameters::AbstractArray{T1,1}, dif::Real; dorder::AbstractArray{T2,1}=zeros(length(hyperparameters) + 2)) where {T1<:Real, T2<:Real}

    @assert length(hyperparameters)==3 "hyperparameters is the wrong length"
    @assert length(dorder)==(length(hyperparameters) + 2) "dorder is the wrong length"
    dorder = convert(Array{Int64,1}, dorder)
    even_time_derivative = 2 * iseven(dorder[2]) - 1
    @assert maximum(dorder) < 3 "No more than two time derivatives for either t1 or t2 can be calculated"

    dorder = append!([sum(dorder[1:2])], dorder[3:end])

    P_kernel_length = hyperparameters[1]
    P_kernel_period = hyperparameters[2]
    RBF_kernel_length = hyperparameters[3]

    if dorder==[4, 0, 0, 1]
        func = 12*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))^2/RBF_kernel_length^3 + 12*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*(4*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - 4*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - RBF_kernel_length^(-2))/RBF_kernel_length^3 + 8*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*dif*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))^3/RBF_kernel_length^3 + exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*dif^2*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))^4/RBF_kernel_length^3 + 3*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*dif^2*(4*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - 4*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - RBF_kernel_length^(-2))^2/RBF_kernel_length^3 + 24*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*dif*(4*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - 4*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - RBF_kernel_length^(-2))*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))/RBF_kernel_length^3 + 6*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*dif^2*(4*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - 4*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - RBF_kernel_length^(-2))*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))^2/RBF_kernel_length^3 - 16*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi^4*dif^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^4*RBF_kernel_length^3) + 16*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi^4*dif^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^4*RBF_kernel_length^3) + 128*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi^3*dif*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period^3*RBF_kernel_length^3) + 64*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi^3*dif^2*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period^3*RBF_kernel_length^3)
    end

    if dorder==[3, 0, 0, 1]
        func = 6*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))/RBF_kernel_length^3 + 6*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*dif*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))^2/RBF_kernel_length^3 + 6*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*dif*(4*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - 4*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - RBF_kernel_length^(-2))/RBF_kernel_length^3 + exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*dif^2*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))^3/RBF_kernel_length^3 + 3*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*dif^2*(4*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - 4*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - RBF_kernel_length^(-2))*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))/RBF_kernel_length^3 + 16*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi^3*dif^2*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period^3*RBF_kernel_length^3)
    end

    if dorder==[2, 0, 0, 1]
        func = 2*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)/RBF_kernel_length^3 + 4*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*dif*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))/RBF_kernel_length^3 + exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*dif^2*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))^2/RBF_kernel_length^3 + exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*dif^2*(4*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - 4*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - RBF_kernel_length^(-2))/RBF_kernel_length^3
    end

    if dorder==[1, 0, 0, 1]
        func = 2*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*dif/RBF_kernel_length^3 + exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*dif^2*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))/RBF_kernel_length^3
    end

    if dorder==[0, 0, 0, 1]
        func = exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*dif^2/RBF_kernel_length^3
    end

    if dorder==[4, 0, 1, 0]
        func = 4*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*(4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period^2) - 4*pi^2*dif*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^3) + 4*pi^2*dif*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^3))*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))^3 + 6*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*(-8*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^3) + 8*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^3) - 16*pi^3*dif*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period^4))*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))^2 + 6*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*(-8*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^3) + 8*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^3) - 16*pi^3*dif*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period^4))*(4*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - 4*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - RBF_kernel_length^(-2)) + 12*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*(4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period^2) - 4*pi^2*dif*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^3) + 4*pi^2*dif*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^3))*(4*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - 4*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - RBF_kernel_length^(-2))*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period)) + 64*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi^4*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^5) - 64*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi^4*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^5) - 192*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi^3*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period^4) + 64*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi^3*(4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period^2) - 4*pi^2*dif*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^3) + 4*pi^2*dif*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^3))*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period^3) + 64*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi^4*dif*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^5) - 64*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi^4*dif*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^5) + 64*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi^5*dif*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)^3/(P_kernel_length^4*P_kernel_period^6) - 64*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi^5*dif*sin(pi*dif/P_kernel_period)^3*cos(pi*dif/P_kernel_period)/(P_kernel_length^4*P_kernel_period^6) + 64*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi^5*dif*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period^6) + 4*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi*dif*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))^4*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period^2) + 12*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi*dif*(4*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - 4*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - RBF_kernel_length^(-2))^2*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period^2) + 256*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi^4*dif*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))*sin(pi*dif/P_kernel_period)^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^4*P_kernel_period^5) + 24*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi*dif*(4*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - 4*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - RBF_kernel_length^(-2))*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))^2*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period^2)
    end

    if dorder==[3, 0, 1, 0]
        func = 3*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*(4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period^2) - 4*pi^2*dif*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^3) + 4*pi^2*dif*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^3))*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))^2 + 3*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*(4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period^2) - 4*pi^2*dif*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^3) + 4*pi^2*dif*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^3))*(4*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - 4*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - RBF_kernel_length^(-2)) + 3*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*(-8*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^3) + 8*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^3) - 16*pi^3*dif*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period^4))*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period)) - 48*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi^3*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period^4) + 16*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi^4*dif*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^5) - 16*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi^4*dif*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^5) + 64*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi^4*dif*sin(pi*dif/P_kernel_period)^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^4*P_kernel_period^5) + 4*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi*dif*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))^3*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period^2) + 12*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi*dif*(4*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - 4*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - RBF_kernel_length^(-2))*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period^2)
    end

    if dorder==[2, 0, 1, 0]
        func = exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*(-8*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^3) + 8*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^3) - 16*pi^3*dif*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period^4)) + 2*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*(4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period^2) - 4*pi^2*dif*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^3) + 4*pi^2*dif*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^3))*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period)) + 4*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi*dif*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))^2*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period^2) + 4*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi*dif*(4*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - 4*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - RBF_kernel_length^(-2))*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period^2)
    end

    if dorder==[1, 0, 1, 0]
        func = exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*(4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period^2) - 4*pi^2*dif*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^3) + 4*pi^2*dif*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^3)) + 4*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi*dif*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period^2)
    end

    if dorder==[0, 0, 1, 0]
        func = 4*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi*dif*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period^2)
    end

    if dorder==[4, 1, 0, 0]
        func = 6*(-8*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^3*P_kernel_period^2) + 8*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^3*P_kernel_period^2))*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))^2 + 6*(-8*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^3*P_kernel_period^2) + 8*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^3*P_kernel_period^2))*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*(4*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - 4*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - RBF_kernel_length^(-2)) + 4*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))^4*sin(pi*dif/P_kernel_period)^2/P_kernel_length^3 + 12*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*(4*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - 4*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - RBF_kernel_length^(-2))^2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^3 + 24*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*(4*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - 4*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - RBF_kernel_length^(-2))*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))^2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^3 - 64*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi^4*sin(pi*dif/P_kernel_period)^4/(P_kernel_length^5*P_kernel_period^4) + 32*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi^4*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^3*P_kernel_period^4) - 32*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi^4*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^3*P_kernel_period^4) + 576*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi^4*sin(pi*dif/P_kernel_period)^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^5*P_kernel_period^4) + 32*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))^3*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^3*P_kernel_period) + 256*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi^3*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))*sin(pi*dif/P_kernel_period)^3*cos(pi*dif/P_kernel_period)/(P_kernel_length^5*P_kernel_period^3) - 128*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi^3*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^3*P_kernel_period^3) + 96*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi*(4*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - 4*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - RBF_kernel_length^(-2))*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^3*P_kernel_period)
    end

    if dorder==[3, 1, 0, 0]
        func = 3*(-8*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^3*P_kernel_period^2) + 8*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^3*P_kernel_period^2))*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period)) + 4*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))^3*sin(pi*dif/P_kernel_period)^2/P_kernel_length^3 + 12*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*(4*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - 4*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - RBF_kernel_length^(-2))*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))*sin(pi*dif/P_kernel_period)^2/P_kernel_length^3 + 64*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi^3*sin(pi*dif/P_kernel_period)^3*cos(pi*dif/P_kernel_period)/(P_kernel_length^5*P_kernel_period^3) - 32*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi^3*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^3*P_kernel_period^3) + 24*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))^2*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^3*P_kernel_period) + 24*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi*(4*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - 4*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - RBF_kernel_length^(-2))*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^3*P_kernel_period)
    end

    if dorder==[2, 1, 0, 0]
        func = (-8*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^3*P_kernel_period^2) + 8*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^3*P_kernel_period^2))*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2) + 4*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))^2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^3 + 4*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*(4*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - 4*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - RBF_kernel_length^(-2))*sin(pi*dif/P_kernel_period)^2/P_kernel_length^3 + 16*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^3*P_kernel_period)
    end

    if dorder==[1, 1, 0, 0]
        func = 4*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))*sin(pi*dif/P_kernel_period)^2/P_kernel_length^3 + 8*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^3*P_kernel_period)
    end

    if dorder==[0, 1, 0, 0]
        func = 4*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*sin(pi*dif/P_kernel_period)^2/P_kernel_length^3
    end

    if dorder==[4, 0, 0, 0]
        func = exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))^4 + 3*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*(4*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - 4*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - RBF_kernel_length^(-2))^2 + 6*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*(4*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - 4*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - RBF_kernel_length^(-2))*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))^2 - 16*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi^4*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^4) + 16*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi^4*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^4) + 64*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi^3*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period^3)
    end

    if dorder==[3, 0, 0, 0]
        func = exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))^3 + 3*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*(4*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - 4*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - RBF_kernel_length^(-2))*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period)) + 16*exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*pi^3*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period^3)
    end

    if dorder==[2, 0, 0, 0]
        func = exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))^2 + exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*(4*pi^2*sin(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - 4*pi^2*cos(pi*dif/P_kernel_period)^2/(P_kernel_length^2*P_kernel_period^2) - RBF_kernel_length^(-2))
    end

    if dorder==[1, 0, 0, 0]
        func = exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)*(-dif/RBF_kernel_length^2 - 4*pi*sin(pi*dif/P_kernel_period)*cos(pi*dif/P_kernel_period)/(P_kernel_length^2*P_kernel_period))
    end

    if dorder==[0, 0, 0, 0]
        func = exp(-2*sin(pi*dif/P_kernel_period)^2/P_kernel_length^2 + (-1/2)*dif^2/RBF_kernel_length^2)
    end

    return even_time_derivative * float(func)  # correcting for amount of t2 derivatives

end


return quasi_periodic_kernel, 3  # the function handle and the number of kernel hyperparameters
